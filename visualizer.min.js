var visualize=function(a){function P(){"undefined"==typeof P.visualRotation&&(P.visualRotation=0),"undefined"==typeof P.imageRotation&&(P.imageRotation=0),console.log("renderVisualization()"),j=requestAnimationFrame(P),G.getByteFrequencyData(H);var a=c.querySelectorAll(".visualizerItem");switch(m){case"barsBottom":case"barsTop":case"barsMiddle":for(var b=0;b<a.length;b++)a[b].style.height=S(H[b],0,255,r,e)+"px";break;case"dotsBottom":for(var b=0;b<a.length;b++)a[b].style.transform="translateY(-"+S(H[b],0,255,0,e-r)+"px)";break;case"dotsTop":for(var b=0;b<a.length;b++)a[b].style.transform="translateY("+S(H[b],0,255,0,e-r)+"px)";break;case"dotsMiddle":for(var b=0;b<a.length/2;b++)a[b].style.transform="translateY(-"+S(H[b],0,255,0,(e-r)/2)+"px)";for(var g=a.length/2;g<a.length;g++)a[g].style.transform="translateY("+S(H[g-H.length],0,255,0,(e-r)/2)+"px)";break;case"barsCircle":var h;h=d>=e?e-e/2-t-v-r:d-d/2-t-v-r;var i=360/f;if(P.visualRotation+=w,P.imageRotation+=x,p){var k=c.querySelector("img");"right"===z?k.style.transform="rotate("+P.imageRotation+"deg)":"left"===z&&(k.style.transform="rotate(-"+P.imageRotation+"deg)")}for(var b=0;b<a.length;b++)a[b].style.height=S(H[b],0,255,r,h)+"px","right"===y?a[b].style.transform="rotate("+(b*i+P.visualRotation)+"deg)translateY(-"+(t+v)+"px)":"left"===y&&(a[b].style.transform="rotate(-"+(b*i+P.visualRotation)+"deg)translateY(-"+(t+v)+"px)");break;case"dotsCircle":var h;h=d>=e?e-e/2-t-v-r:d-d/2-t-v-r;var i=360/f;if(P.visualRotation+=w,P.imageRotation+=x,p){var k=c.querySelector("img");"right"===z?k.style.transform="rotate("+P.imageRotation+"deg)":"left"===z&&(k.style.transform="rotate(-"+P.imageRotation+"deg)")}for(var b=0;b<a.length;b++)"right"===y?a[b].style.transform="rotate("+(b*i+P.visualRotation)+"deg)translateY(-"+S(H[b],0,255,t+v,t+v+h)+"px)":"left"===y&&(a[b].style.transform="rotate(-"+(b*i+P.visualRotation)+"deg)translateY(-"+S(H[b],0,255,t+v,t+v+h)+"px)")}}function R(){console.log("stopWhenVisualsReset()"),k=requestAnimationFrame(R),Q?(console.log("cancelling"),cancelAnimationFrame(j),cancelAnimationFrame(k),Q=!1):Q=T()}function S(a,b,c,d,e){return(a-b)*(e-d)/(c-b)+d}function T(){for(var a=1;a<H.length;a++)if(H[a]!==H[0])return!1;return!0}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=["barsBottom","barsTop","barsMiddle","barsCircle","dotsBottom","dotsTop","dotsMiddle","dotsCircle"];if(!a.audioElement||"AUDIO"!==a.audioElement.nodeName||!a.audioElement.hasAttribute("src")){var C=document.getElementsByTagName("AUDIO")[0];if(void 0===C||!C.hasAttribute("src"))return console.log("No audio element found / audio element has no source"),!1}if(!a.container||"DIV"!==a.container.nodeName)return console.log("No container for visuals specified"),!1;if(a.amountOfVisuals&&"number"!=typeof a.amountOfVisuals)return console.log("amountOfVisuals should be a number"),!1;if(a.shape&&-1===B.indexOf(a.shape))return console.log("shape not supported"),!1;if(a.color&&a.dynamicColor)return console.log("color and dynamicColor can't be used together"),!1;switch(b=a.audioElement||document.getElementsByTagName("AUDIO")[0],c=a.container,d=c.offsetWidth,e=c.offsetHeight,l=!1,m=a.shape||"barsBottom",f=a.amountOfVisuals||100,g=a.distance||"small",n=a.color?a.color:a.dynamicColor?void 0:"#000",o=a.dynamicColor||void 0,p=a.image||void 0,q=a.borderRadius||0,r=a.minHeight||e/20,t=16*a.circleSize||96,u=a.keepPosition||!1,v=16*a.circleDistance||0,w=a.visualRotationSpeed||0,x=a.imageRotationSpeed||0,y=a.visualRotationDirection||"right",z=a.imageRotationDirection||"right",A=a.showControls||!1,c.style.position="relative",c.style.fontSize="16px",m){case"barsBottom":case"barsTop":case"barsMiddle":case"dotsBottom":case"dotsTop":case"dotsMiddle":switch(g){case"none":s=d/f,h=0,i=0;break;case"small":1.5>d/f-2?(s=1.5,f=d/(s+2)):s=d/f-2,h=1,i=2;break;case"medium":1.5>d/f-4?(s=1.5,f=d/(s+4)):s=d/f-4,h=2,i=4;break;case"large":1.5>d/f-6?(s=1.5,f=d/(s+6)):s=d/f-6,h=3,i=6}break;case"barsCircle":case"dotsCircle":var D=2*Math.PI*t;switch(g){case"none":s=D/f;break;case"small":1.5>D/f-1?(s=1.5,f=D/(s+1)):s=D/f-1;break;case"medium":1.5>D/f-2.5?(s=1.5,f=D/(s+2.5)):s=D/f-2.5;break;case"large":1.5>D/f-4?(s=1.5,f=D/(s+4)):s=D/f-4}}var E=new(window.AudioContext||window.webkitAudioContext),F=E.createMediaElementSource(b),G=E.createAnalyser(),H=new Uint8Array(f);switch(F.connect(G),F.connect(E.destination),m){case"barsBottom":case"dotsBottom":for(var I=0;I<H.length;I++){var J=document.createElement("div");J.className="visualizerItem",J.style.cssText="position: absolute; bottom: 0;display: inline-block;min-height: "+r+"px;width: "+s+"px;margin: 0 "+h+"px 0 "+I*(s+i)+"px;border-radius: "+q+";background: "+n+";",c.appendChild(J)}p&&(c.style.background="url("+p+") no-repeat",c.style.backgroundSize="100% 100%");break;case"barsTop":case"dotsTop":for(var I=0;I<H.length;I++){var J=document.createElement("div");J.className="visualizerItem",J.style.cssText="position: absolute; top: 0;display: inline-block;min-height: "+r+"px;width: "+s+"px;margin: 0 "+h+"px 0 "+I*(s+i)+"px;border-radius: "+q+";background: "+n+";",c.appendChild(J)}p&&(c.style.background="url("+p+") no-repeat",c.style.backgroundSize="100% 100%");break;case"barsMiddle":for(var I=0;I<H.length;I++){var J=document.createElement("div");J.className="visualizerItem",J.style.cssText="position: absolute; top: 0;bottom: 0;display: inline-block;min-height: "+r+"px;height: "+r+"px;width: "+s+"px;margin: auto "+h+"px auto "+I*(s+i)+"px;border-radius: "+q+";background: "+n+";",c.appendChild(J)}p&&(c.style.background="url("+p+") no-repeat",c.style.backgroundSize="100% 100%");break;case"dotsMiddle":for(var K=0;2>K;K++)for(var I=0;I<H.length;I++){var J=document.createElement("div");J.className="visualizerItem",J.style.cssText="position: absolute; top: 0;bottom: 0;display: inline-block;min-height: "+r+"px;height: "+r+"px;width: "+s+"px;margin: auto "+h+"px auto "+I*(s+i)+"px;border-radius: "+q+";background: "+n+";",c.appendChild(J)}p&&(c.style.background="url("+p+") no-repeat",c.style.backgroundSize="100% 100%");break;case"barsCircle":case"dotsCircle":for(var I=0;I<H.length;I++){var J=document.createElement("div");J.className="visualizerItem";var L=360/f;J.style.cssText="position: absolute; bottom: 50%;left: 0;right: 0;z-index: 2;margin: auto;display: inline-block;min-height: "+r+"px;width: "+s+"px;border-radius: "+q+";background: "+n+";transform-origin: bottom;font-size: 16px;transform: rotate("+I*L+"deg) translateY(-"+(t+v)+"px);",c.appendChild(J)}if(p){var M=document.createElement("img");M.src=p,M.style.cssText="position: absolute;z-index: 1;margin: auto;top: 0;bottom: 0;left: 0;right: 0;border-radius: 50%;width: "+2*t+"px;height: "+2*t+"px;",visualsContainer.appendChild(M)}if(A){var N=document.createElement("div");N.id="playBtn",N.style.cssText="position: absolute;z-index: 2;margin: auto;top: 0;bottom: 0;left: 0;right: 0;width: 50px;height: 100px;text-align: center;font-size: 20px",visualsContainer.appendChild(N);var O=document.createElement("i");O.className="fa fa-play fa-5x",N.appendChild(O)}}var Q=!1;b.addEventListener("play",function(){console.log("started"),l||(j=requestAnimationFrame(P),l=!0)}),b.addEventListener("pause",function(){console.log("paused"),l&&(u?cancelAnimationFrame(j):k=requestAnimationFrame(R),l=!1)}),N.addEventListener("mouseenter",function(){N.style.color="grey"}),N.addEventListener("mouseleave",function(){N.style.color="#000"}),N.addEventListener("click",function(){l?(O.className="fa fa-play fa-5x",N.style.width="50px",b.pause()):(O.className="fa fa-pause fa-5x",N.style.width="86px",b.play())})};